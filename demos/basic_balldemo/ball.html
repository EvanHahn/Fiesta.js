<!DOCTYPE html>
<html>
<head>
	
	<!-- Fiesta -->
	<script src="../../fiesta.js"></script>
	
</head>
<body>

	<script>
	
	// Config
	var room_width = 800;
	var room_height = 300;
	var gravity = 500;
		
	// Ballin'
	var Ball = new Fiesta.Class(Fiesta.PhysicalGameObject, {
		
		// Constructor
		initialize: function() {
			
			// Call super
			this.callSuper();
			
			// Sprites
			this._spr_ball = new Fiesta.Sprite("ball.gif");
			this._spr_ball.setOrigin(16, 16);
			this.setSprite(this._spr_ball);
			
			// Config
			this._friction = 100;
			this._velocityBump = 200;
			this._acceleration = 500;
			this._jumpSpeed = 300;
			
			// Go for it!
			this.setFrictionX(this._friction);
			this.setAccelerationY(gravity);
			this.setMass(10);
		},
		
		// Movement
		moveLeft: function() {
			if (this.getVelocityX() === 0)
				this.setVelocityX(this._velocityBump * -1);
			this.setAccelerationX(this._acceleration * -1);
		},
		moveRight: function() {
			if (this.getVelocityX() === 0)
				this.setVelocityX(this._velocityBump);
			this.setAccelerationX(this._acceleration);
		},
		stopX: function() { this.setAccelerationX(0); },
		jump: function() { this.setVelocityY(-this._jumpSpeed); },
		goTo: function(x, y) {
			this.setCoordinates(x, y);
			this.setVelocityY(0);
		},
		
		// On spawn
		onSpawn: function() {
			this.callSuper();
			Fiesta.bindCommands(this, {
				"left keydown": this.moveLeft,
				"right keydown": this.moveRight,
				"left keyup": this.stopX,
				"right keyup": this.stopX,
				"space keydown": this.jump,
				"right click": this.goTo
			});
		},
		
		// On frame
		onFrame: function() {
			this.callSuper();
			if ((this.getX() < (0 + this.getSprite().getOriginX())) || (this.getX() > (room_width - this.getSprite().getOriginX())))
				this.setVelocityX(-this.getVelocityX())
			if (this.getY() > (room_height - this.getSprite().getOriginY())) {
				this.setVelocityY(this.getVelocityY() * -0.9);
				this.setY(room_height - this.getSprite().getOriginY());
				if (Math.abs(this.getVelocityY()) < 45)
					this.setVelocityY(0);
			}
		}
		
	});
	
	// Ball spawner
	var BallSpawner = new Fiesta.Class(Fiesta.GameObject, {
		
		// Constructor
		intialize: function() {
			this.callSuper();
		},
		
		// Spawn a ball
		spawnBall: function(x, y) {
			var ball = new Ball();
			this.getPlayground().spawn(ball);
			ball.setCoordinates(x, y);
			this.ballCount = this.ballCount + 1;
		},
		
		// Bind commmands
		onSpawn: function() {
			this.callSuper();
			Fiesta.bindCommands(this, {
				"left click": this.spawnBall
			});
		}
		
	});
	
	// Set up the playground
	var playground = new Fiesta.Playground(room_width, room_height, "2d", 60);
	var ballSpawner = new BallSpawner();
	playground.spawn(ballSpawner);
	
	// Let's go for it!
	playground.place(document.body);
	playground.setBackgroundColor("000");
	
	</script>

</body>
</html>
