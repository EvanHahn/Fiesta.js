<!DOCTYPE html>
<html>
<head>
	
	<!-- Fiesta -->
	<script>
		FIESTA_PATH = "../../fiesta";
	</script>
	<script src="../../fiesta/fiesta.js"></script>
	
	<!-- Styles -->
	<link rel="stylesheet" href="http://yui.yahooapis.com/2.9.0/build/reset/reset-min.css" />
	<style>
		.fiesta_playground {
			background-color: #000;
		}
	</style>
	
</head>
<body>

	<script>
	
	// Config
	var room_width = 800;
	var room_height = 300;
	var gravity = 500;
		
	// Ballin'
	var Ball = new JS.Class(Fiesta.PhysicalGameObject, {
		
		// Constructor
		initialize: function() {
			
			// Call super
			this.callSuper();
			
			// Sprites
			this._spr_ball = new Fiesta.Sprite("ball.gif");
			this._spr_ball.setOrigin(16, 16);
			this.setSprite(this._spr_ball);
			
			// Config
			this._friction = 100;
			this._velocityBump = 200;
			this._acceleration = 500;
			this._jumpSpeed = 500;
			
			// Go for it!
			this.setFrictionX(this._friction);
			this.setFrictionY(this._friction);
			this.setAccelerationY(gravity);
			
		},
		
		// Movement
		moveLeft: function() {
			if (this.getVelocityX() === 0)
				this.setVelocityX(this._velocityBump * -1);
			this.setAccelerationX(this._acceleration * -1);
		},
		moveRight: function() {
			if (this.getVelocityX() === 0)
				this.setVelocityX(this._velocityBump);
			this.setAccelerationX(this._acceleration);
		},
		stopX: function() { this.setAccelerationX(0); },
		jump: function() { this.setVelocityY(-this._jumpSpeed); },
		goTo: function(x, y) {
			this.setCoordinates(x, y);
			this.setVelocityY(0);
		},
		
		// On spawn
		onSpawn: function() {
			this.callSuper();
			Fiesta.bindCommands(this, {
				"left": this.moveLeft,
				"right keydown": this.moveRight,
				"left keyup": this.stopX,
				"right keyup": this.stopX,
				"space": this.jump,
				"right click": this.goTo
			});
		},
		
		// On frame
		onFrame: function() {
			this.callSuper();
			if ((this.getX() < (0 + this.getSprite().getOriginX())) || (this.getX() > (room_width - this.getSprite().getOriginX())))
				this.setVelocityX(-this.getVelocityX())
			if (this.getY() > (room_height - this.getSprite().getOriginY())) {
				this.setVelocityY(this.getVelocityY() * -0.9);
				this.setY(room_height - this.getSprite().getOriginY());
				if (Math.abs(this.getVelocityY()) < 45)
					this.setVelocityY(0);
			}
		}
		
	});
	
	// Box
	var Box = new JS.Class(Fiesta.PhysicalGameObject, {
		
		// Constructor
		initialize: function() {
			
			// Call super
			this.callSuper();
			
			// Sprites
			this._spr_box = new Fiesta.Sprite("box.gif");
			this._spr_box.setOrigin(16, 16);
			this.setSprite(this._spr_box);
			
			// Config
			this._friction = 100;
			
			// Go for it!
			this.setFrictionX(this._friction);
			this.setFrictionY(this._friction);
			this.setAccelerationY(gravity);
			this.setVelocityX(200);
			
		},
		
		// On frame
		onFrame: function() {
			this.callSuper();
			if ((this.getX() < (0 + this.getSprite().getOriginX())) || (this.getX() > (room_width - this.getSprite().getOriginX())))
				this.setVelocityX(-this.getVelocityX())
			if (this.getY() > (room_height - this.getSprite().getOriginY())) {
				this.setVelocityY(this.getVelocityY() * -0.5);
			}
		}
		
	});
	
	// Set up the playground
	var playground = new Fiesta.Playground(room_width, room_height, "2d", 60);
	
	// Spawn the objects
	var ball = new Ball();
	playground.spawn(ball);
	ball.setCoordinates(100, 100);
	var box = new Box();
	playground.spawn(box);
	box.setCoordinates(room_width - 100, 100);
	
	// Let's go for it!
	playground.place(document.getElementsByTagName("body")[0]);
	
	</script>

</body>
</html>